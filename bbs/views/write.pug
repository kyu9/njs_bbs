link(rel='stylesheet', href='stylesheets/css/bootstrap.css')
link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css')
ons-page
    ons-toolbar
    div(style='text-align: center; margin-top:3%')
        section(style='padding: 8px')
            textarea.text-input#title(type='text', ng-model='text', placeholder='제목', style='width: 80%; height:30px;')
        section(style='padding: 0 8px 8px')
            textarea.textarea#content(ng-model='text2', placeholder='내용', style='width: 80%; height: 400px;')
            pre
            div(style='text-align:right')
                input#img(type='file', name='img')

        div(style='padding: 0 8px 8px')
            button(type="button" class='btn btn-primary' onclick='aaaa()') 글 쓰기
        div(style='padding: 0 8px 8px')
            button(type='button' class='btn btn-primary' onclick="location.href='/posts'") 게시판으로 돌아가기

script.
    let title = document.getElementById('title');
    let content = document.getElementById('content');
    let url = '/write_receive';
    let furl = '/write_receive_file';
    let img = document.getElementById('img');
    function aaaa() {
       var con_test = confirm('게시물을 작성하시겠습니까??');
       if(con_test == true){
           if (img.files[0] == null) {
               let data = {
                   'title': title.value,
                   'content': content.value,
               }
               fetch(url, {
                   method: 'POST',
                   headers: {'Content-Type': 'application/json;charset=utf-8'},
                   body: JSON.stringify(data),
               })
                   .then(response => response.json())
                   .catch(error => {
                       console.error('Error: ', error)
                   })
                   .then(response => {
                       if (response.result == 'ok') {
                           alert('게시물 작성완료!')
                           history.back()
                       } else if (response.result == 'no') {
                           alert('write과정에서 에러 발생!')
                           return
                       }
                   })
           } else {
               let formData = new FormData();
               formData.append('title', title.value);
               formData.append('content', content.value);
               formData.append('img', img.files[0]);
               fetch(furl, {
                   method: 'POST',
                   headers: {},
                   body: formData,
               })
                   .then(response => response.json())
                   .catch(error => {
                       console.error('Error: ', error)
                   })
                   .then(response => {
                       if (response.result == 'ok') {
                           alert('게시물 작성완료!')
                           history.back()
                       } else if (response.result == 'no') {
                           alert('비밀번호를 다시 입력하세요!')
                           return
                       }
                   })
           }
       }else{
           return;
       }
    }